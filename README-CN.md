# Memorizer（桌面版 + PWA）

Memorizer 是一个综合的间隔重复学习系统，具有最小化干扰的桌面应用程序、伪装横幅（正常/迷你）用于快速复习、主窗口用于仪表板和计划，以及配套的渐进式网页应用（PWA）用于移动访问和无缝数据同步。

## 功能特点

### 桌面应用程序
- **伪装横幅**（正常/迷你）支持深色/浅色主题和任务栏感知定位
- **高级翻转循环**：正面 → 背面 → 全部（正面+背面+读音/词性+示例）→ 正面
- **四个评分按钮**（再次/困难/良好/简单），深色主题有清晰的色调，浅色主题有柔和的色调
- **进度跟踪**显示今日进度/目标（限制在目标范围内）和视觉指示器
- **牌组管理**具有筛选功能（全部牌组或特定牌组ID），通过数据库与PWA共享
- **手动数据输入**（新牌组，新条目）支持Excel导入/导出功能
- **托盘控制**和序列化提醒（无重叠横幅）
- **仪表板**带有全面的统计图表和任务进度指示器
- **多显示器支持**具有自动定位和任务栏覆盖选项
- **首选项系统**支持运行时配置持久化

### Web界面
- **基于浏览器的访问**启用同步服务器时可用（默认端口7070/7071）
- **完整的桌面功能**包括牌组管理、浏览和学习
- **服务器端渲染**具有响应式设计和深色/浅色主题支持
- **直接数据库访问**无需移动配对要求
- **跨平台兼容性**可从任何现代浏览器访问

### PWA（渐进式网页应用）
- **移动友好的界面**支持随时随地学习
- **离线功能**具有本地数据缓存
- **实时同步**通过REST API与桌面应用程序同步
- **二维码配对**实现安全的桌面移动连接
- **响应式设计**支持深色/浅色主题
- **触摸优化的控件**提供移动学习体验

### SRS算法
- **间隔重复引擎**具有可配置间隔
- **高级调度**支持批处理和暂停选项
- **性能跟踪**具有详细的复习历史
- **自适应难度**基于用户评分和响应时间

## 构建和运行

### 前置条件
- Java 8 JDK
- Maven 3.x
- Node.js 16+ （用于PWA开发）

### 桌面应用程序

1. 清理并打包项目：
   ```bash
   mvn clean package
   ```
2. 运行应用程序：
   ```bash
   java -jar target/memorizer-0.5.0-shaded.jar
   ```

### PWA 开发

1. 导航到PWA目录：
   ```bash
   cd pwa
   ```
2. 安装依赖：
   ```bash
   npm install
   ```
3. 启动开发服务器：
   ```bash
   npm run dev
   ```
4. 构建生产版本：
   ```bash
   npm run build
   ```

### 注意事项
- 如果 Maven 尝试使用本地 Nexus，请更新 `settings.xml` 以指向 Maven Central
- 对于没有捆绑JavaFX的环境，使用 `openjfx` 配置文件：
  ```bash
  mvn -Popenjfx -Djavafx.platform=win clean package  # 相应地使用 'mac'/'linux'
  ```

## 配置

### 桌面应用程序（`application.properties`）

关键设置在内联文档中有说明。要点：

- `app.db.path`：H2数据库文件路径（默认：`./data/memo`）
- `app.h2.console.enabled`：启用H2 Web控制台（默认：`true`）
- `app.h2.console.port`：H2 Web控制台端口（默认：`8084`）

**UI设置**（现在通过首选项对话框在运行时管理）：
- `app.ui.mode`：伪装模式（normal|mini）
- `app.ui.theme`：伪装抽屉的主题（dark|light）
- `app.window.*`：窗口定位和大小调整选项
- `app.ui.examples.*`：示例显示配置

**学习设置**：
- `app.study.daily-target`：每日进度目标（默认：50）
- `app.study.batch-size`：每批卡片数量
- `app.study.min/max-interval-minutes`：SRS间隔边界
- `app.study.snooze-*`：暂停行为设置
- `app.deck.filter`：牌组筛选（all 或牌组ID）

**Web服务器**：
- 默认端口：7070（HTTP）和 7071（HTTPS）
- 支持HTTP和HTTPS，具有自签名证书
- 二维码生成用于安全移动配对
- 在 `/web` 端点提供服务器端渲染的Web界面
- 从 `/web/static/` 提供静态资源（CSS、JS、图像）

### Web界面配置

Web界面通过浏览器提供完整的桌面功能，访问与桌面应用程序相同的数据库。除了启用同步服务器外，无需额外配置。

### PWA 配置

PWA与桌面应用程序共享相同的数据库，并通过REST API同步数据。配置通过Web界面自动处理。

## 使用方法

### 桌面应用程序

**伪装横幅快捷键**：
- `SPACE/ENTER`：翻转卡片内容
- `1/2/3/4`：评分卡片（再次/困难/良好/简单）
- `ESC`：隐藏横幅（可选暂停）
- `M`：在正常/迷你模式间切换
- `T`：在深色/浅色主题间切换
- `F8`：显示/隐藏横幅

**主窗口**：
- **数据菜单**：新牌组，新条目（添加笔记 + 卡片），管理牌组，同步服务器
- **查看菜单**：牌组选择（全部牌组或特定牌组），仪表板
- **学习菜单**：开始学习会话，考试模式
- **帮助菜单**：用户手册，关于

**Web界面访问**：
1. 通过数据 → 同步服务器启用同步服务器
2. 在浏览器中打开 `http://localhost:7070/web`（如果启用HTTPS则为 `https://localhost:7071/web`）
3. 浏览器中提供完整的桌面功能

**PWA配对**：
1. 通过数据 → 同步服务器启用同步服务器
2. 使用移动设备扫描二维码
3. 自动同步开始

### Web界面（浏览器）

- **主屏幕**：快速访问牌组、浏览和学习部分
- **牌组管理**：创建、编辑和组织学习牌组
- **浏览模式**：查找和编辑笔记，具有完整的搜索功能
- **学习模式**：基于浏览器的卡片复习，支持键盘快捷键
- **主题切换**：在深色和浅色主题之间切换

### PWA（移动端）

- **牌组屏幕**：浏览和选择学习牌组
- **学习模式**：触摸优化的卡片复习界面
- **连接屏幕**：与桌面应用程序配对
- **同步控制**：手动同步和完全刷新选项

## 仪表板功能

- 摘要统计：到期卡片、新卡片、总卡片数、总笔记数、今日复习、计划进度
- 图表：
  - 日复习量（最近7天）- 柱状图显示复习活动
  - 评分分布 - 柱状图显示评分频率
  - 卡片状态分布 - 柱状图显示卡片状态
- 任务进度指示器：视觉指示器显示今日任务进度，颜色编码
  - 绿色：已完成任务
  - 橙色：待处理任务
  - 灰色：未开始任务

## 架构

### 数据库架构
- **牌组**：卡片的组织单元
- **笔记**：内容存储，包含正面/背面文本、读音、词性、示例和元数据
- **卡片**：带有调度信息的单个复习卡片（到期日期、间隔等）
- **复习日志**：所有复习会话的详细历史

### SRS算法
- 实现具有可配置间隔的间隔重复系统
- 支持四个评分等级，具有不同的间隔倍数
- 包含模糊因子，防止卡片同时到期
- 分别处理已毕业卡片和新卡片

### Web API
- 用于牌组、笔记和卡片管理的RESTful端点
- 桌面和移动之间的实时同步
- 使用二维码和临时令牌的安全配对
- 支持HTTP和HTTPS连接

### PWA技术栈
- **前端**：Vue 3 与 Composition API
- **构建工具**：Vite
- **数据库**：Dexie（IndexedDB包装器）
- **路由**：Vue Router 4
- **PWA**：Vite PWA插件用于离线功能

## 故障排除

### 常见问题

- **伪装横幅定位**：如果在任务栏附近显示间隙，请确认 `overlay-taskbar=false` 和典型 DPI（100–150%）。
- **进度显示**：如果今天显示 54/50，这在视觉上限制为 50/50；进度条永远不会超过 100%。
- **示例不显示**：请确保翻转状态为全部（第三次点击）并且笔记中有示例内容。
- **图表不显示**：请确保数据库中有复习历史记录。
- **PWA连接问题**：检查同步服务器是否已启用，二维码是否正确扫描。

### 数据库问题

- **H2控制台**：启用时可通过 `http://localhost:8084` 访问
- **数据库位置**：默认为 `./data/memo`（可通过 `app.db.path` 配置）
- **备份**：复制数据库文件（`memo.mv.db`、`memo.trace.db`）进行备份

### 性能问题

- **大型牌组**：使用牌组筛选限制学习会话中的卡片数量
- **内存使用**：调整批处理大小（`app.study.batch-size`）以获得最佳性能
- **网络同步**：使用Wi-Fi进行更快的桌面移动同步

## 贡献

- 风格：Java 8，SLF4J 日志，4 空格缩进
- 测试：JUnit 5 模式可以添加到 src/test/java 下

## 目标和路线图

### 目标
- 提供一个快速、低摩擦的伪装复习横幅，具有可靠的位置定位。
- 提供一个简单的主窗口用于概览和手动数据输入（牌组、笔记）。
- 通过共享数据库保持桌面版和 PWA 的对齐，包括可选的牌组筛选。

### 已完成
- 伪装 UI（正常/迷你）、深色/浅色主题、严格高度、迚度覆盖。
- 深色评分按钮带有填充色调；浅色柔和样式；正确的对齐。
- 翻转循环逻辑：正面 → 背面 → 正面+背面+读音/词性+示例 → 正面。
- 正常模式下的示例（多行滚动器）和迷你模式（单行；跑马灯）。
- 深色弹出窗口（编辑/添加）带有可见的输入字段和焦点样式。
- 主/学习窗口：顶部对齐，垂直滚动，调整到操作系统工作区大小。
- 牌组筛选（查看 → 牌组）与 PlanService 筛选；手动新牌组/新条目。
- 帮助菜单中的用户手册；创建/保存时的状态栏通知。
- 带有统计图表和任务进度指示器的仪表板。
- 所有窗口的应用图标。
- 改进的窗口大小调整和布局。
- 同步服务器控制移到数据菜单。
  
### 待完成 / 下一步
- 多显示器/任务栏边缘放置；任务栏在顶部/左侧/右侧。
- 管理牌组窗口（列表/重命名/删除）；可选的伪装牌组徽章和热键。
- 创建/保存成功的托盘气泡；保持窗口内通知。
- Maven 仓库配置默认为 Central；添加 CI。
- 添加测试（PlanService 牌组筛选，伪装翻转状态，存储库路径）。
- 持久化按牌组的挑战最后大小提示。